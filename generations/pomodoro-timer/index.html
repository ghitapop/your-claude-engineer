<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pomodoro Timer</title>
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg: #1a1a2e;
      --surface: #16213e;
      --accent: #ff6347;
      --accent-dim: rgba(255, 99, 71, 0.2);
      --accent-dark: #e5533d;
      --text-primary: #eaeaea;
      --text-secondary: #888;
      --ring-size: 280px;
      --ring-stroke: 8;
    }

    body {
      background: var(--bg);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        Oxygen, Ubuntu, Cantarell, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    h1 {
      font-size: 1.1rem;
      font-weight: 600;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 24px;
    }

    /* ---- Session type badge ---- */
    .session-type-badge {
      font-size: 0.7rem;
      font-weight: 700;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      padding: 5px 16px;
      border-radius: 20px;
      margin-bottom: 24px;
      background: var(--accent-dim);
      color: var(--accent);
      border: 1px solid rgba(255, 99, 71, 0.35);
      transition: background 0.4s ease, color 0.4s ease, border-color 0.4s ease;
    }

    .session-type-badge.break {
      --badge-color: #4da6ff;
      background: rgba(77, 166, 255, 0.15);
      color: var(--badge-color);
      border-color: rgba(77, 166, 255, 0.3);
    }

    .session-type-badge.long-break {
      --badge-color: #50d890;
      background: rgba(80, 216, 144, 0.15);
      color: var(--badge-color);
      border-color: rgba(80, 216, 144, 0.3);
    }

    /* ---- Pomodoro count dots ---- */
    .pomodoro-count {
      display: flex;
      gap: 8px;
      margin-top: 28px;
      align-items: center;
    }

    .pomodoro-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent-dim);
      border: 1.5px solid rgba(255, 99, 71, 0.3);
      transition: background 0.3s ease, transform 0.2s ease;
    }

    .pomodoro-dot.filled {
      background: var(--accent);
      border-color: var(--accent);
      transform: scale(1.15);
    }

    /* ---- Total session counter ---- */
    .session-counter {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .session-counter-display {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .session-counter-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--accent);
      font-variant-numeric: tabular-nums;
      line-height: 1;
    }

    .session-counter-label {
      font-size: 0.65rem;
      font-weight: 600;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--text-secondary);
    }

    .btn-reset-counter {
      font-size: 0.7rem;
      padding: 7px 18px;
      border-color: rgba(255, 99, 71, 0.4);
      color: var(--text-secondary);
      letter-spacing: 0.1em;
    }

    .btn-reset-counter:hover {
      background: var(--accent-dim);
      color: var(--accent);
      border-color: var(--accent);
      box-shadow: 0 0 12px rgba(255, 99, 71, 0.25);
    }

    @keyframes counterPop {
      0%   { transform: scale(1); }
      40%  { transform: scale(1.35); }
      100% { transform: scale(1); }
    }

    .counter-pop {
      animation: counterPop 0.35s ease-out;
    }

    /* ---- Timer ring ---- */
    .timer-wrapper {
      position: relative;
      width: var(--ring-size);
      height: var(--ring-size);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .progress-ring {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .ring-bg {
      fill: none;
      stroke: var(--accent-dim);
      stroke-width: var(--ring-stroke);
    }

    .ring-progress {
      fill: none;
      stroke: var(--accent);
      stroke-width: var(--ring-stroke);
      stroke-linecap: round;
      transition: stroke-dashoffset 0.5s linear, stroke 0.4s ease;
    }

    .ring-progress.break {
      stroke: #4da6ff;
    }

    .ring-progress.long-break {
      stroke: #50d890;
    }

    /* ---- Timer face ---- */
    .timer-face {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      z-index: 1;
    }

    .timer-display {
      font-size: 4rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      color: var(--text-primary);
      font-variant-numeric: tabular-nums;
      line-height: 1;
      transition: opacity 0.2s ease;
    }

    .timer-display.flash {
      opacity: 0.4;
    }

    .session-label {
      font-size: 0.75rem;
      font-weight: 500;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-secondary);
      transition: opacity 0.3s ease;
    }

    /* ---- Controls ---- */
    .controls {
      display: flex;
      gap: 16px;
      margin-top: 40px;
      align-items: center;
    }

    .btn {
      background: none;
      border: 2px solid var(--accent);
      color: var(--accent);
      border-radius: 50px;
      padding: 12px 32px;
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease,
                  transform 0.12s ease, box-shadow 0.2s ease, opacity 0.2s ease;
      user-select: none;
      position: relative;
      overflow: hidden;
    }

    .btn:hover {
      background: var(--accent);
      color: #fff;
      box-shadow: 0 0 18px rgba(255, 99, 71, 0.45);
    }

    .btn:active {
      transform: scale(0.94);
      box-shadow: 0 0 8px rgba(255, 99, 71, 0.3);
    }

    .btn:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 3px;
    }

    .btn-primary {
      background: var(--accent);
      color: #fff;
      min-width: 120px;
    }

    .btn-primary:hover {
      background: var(--accent-dark);
      border-color: var(--accent-dark);
      box-shadow: 0 0 18px rgba(255, 99, 71, 0.55);
    }

    .btn-icon {
      padding: 12px 20px;
      font-size: 1.1rem;
      line-height: 1;
    }

    /* Ripple animation on click */
    @keyframes ripple {
      0%   { transform: scale(0); opacity: 0.5; }
      100% { transform: scale(3); opacity: 0; }
    }

    .btn .ripple {
      position: absolute;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      background: rgba(255, 255, 255, 0.35);
      pointer-events: none;
      transform: scale(0);
      animation: ripple 0.45s ease-out forwards;
    }

    /* Session transition flash */
    @keyframes sessionFlash {
      0%   { opacity: 0.15; }
      50%  { opacity: 1; }
      100% { opacity: 1; }
    }

    .session-change {
      animation: sessionFlash 0.4s ease-out;
    }

    /* Start button text transition */
    .btn-primary span {
      display: inline-block;
      transition: transform 0.18s ease, opacity 0.18s ease;
    }

    /* ---- Responsive ---- */
    @media (max-width: 360px) {
      :root {
        --ring-size: 220px;
      }

      .timer-display {
        font-size: 3rem;
      }

      .controls {
        gap: 10px;
      }

      .btn {
        padding: 10px 20px;
        font-size: 0.8rem;
      }

      .btn-icon {
        padding: 10px 14px;
      }
    }
  </style>
</head>
<body>
  <h1>Pomodoro Timer</h1>

  <div class="session-type-badge" id="sessionTypeBadge" aria-live="polite">Work Session</div>

  <div class="timer-wrapper" aria-label="Timer progress ring">
    <svg class="progress-ring" viewBox="0 0 280 280" aria-hidden="true">
      <circle
        class="ring-bg"
        cx="140" cy="140"
        r="126"
      />
      <circle
        class="ring-progress"
        id="ringProgress"
        cx="140" cy="140"
        r="126"
      />
    </svg>

    <div class="timer-face">
      <div class="timer-display" id="timerDisplay" aria-live="polite">25:00</div>
      <div class="session-label" id="sessionLabel">Work Session</div>
    </div>
  </div>

  <div class="controls">
    <button class="btn btn-icon" id="resetBtn" aria-label="Reset timer" title="Reset">&#8635;</button>
    <button class="btn btn-primary" id="startBtn" aria-label="Start timer">
      <span id="startBtnText">Start</span>
    </button>
    <button class="btn btn-icon" id="skipBtn" aria-label="Skip to next session" title="Skip">&#8677;</button>
  </div>

  <div class="pomodoro-count" id="pomodoroCount" aria-label="Pomodoro progress: 0 of 4 completed">
    <div class="pomodoro-dot" id="dot0"></div>
    <div class="pomodoro-dot" id="dot1"></div>
    <div class="pomodoro-dot" id="dot2"></div>
    <div class="pomodoro-dot" id="dot3"></div>
  </div>

  <div class="session-counter">
    <div class="session-counter-display">
      <div class="session-counter-value" id="totalCountDisplay" aria-live="polite" aria-label="Total completed pomodoros: 0">0</div>
      <div class="session-counter-label">Pomodoros Completed</div>
    </div>
    <button class="btn btn-reset-counter" id="resetCounterBtn" aria-label="Reset pomodoro counter">Reset Counter</button>
  </div>

  <script>
    // ---- Constants ----
    const SESSIONS = {
      work:       { label: "Work Session",  duration: 25 * 60, type: "work" },
      shortBreak: { label: "Short Break",   duration:  5 * 60, type: "short-break" },
      longBreak:  { label: "Long Break",    duration: 15 * 60, type: "long-break" },
    };

    // Pomodoro technique: 4 work sessions, then long break
    // Cycle: work -> shortBreak -> work -> shortBreak -> work -> shortBreak -> work -> longBreak -> repeat
    const SESSION_CYCLE = ["work", "shortBreak", "work", "shortBreak", "work", "shortBreak", "work", "longBreak"];

    // ---- SVG ring setup ----
    const RADIUS = 126;
    const CIRCUMFERENCE = 2 * Math.PI * RADIUS;

    const ringProgress = document.getElementById("ringProgress");
    ringProgress.style.strokeDasharray  = CIRCUMFERENCE;
    ringProgress.style.strokeDashoffset = 0;

    function setRingProgress(fraction) {
      const offset = CIRCUMFERENCE * (1 - fraction);
      ringProgress.style.strokeDashoffset = offset;
    }

    // ---- LocalStorage key ----
    const STORAGE_KEY = "pomodoro_total_completed";

    // ---- State ----
    let cycleIndex       = 0;
    let currentSession   = SESSION_CYCLE[cycleIndex];
    let totalSeconds     = SESSIONS[currentSession].duration;
    let remaining        = totalSeconds;
    let running          = false;
    let intervalId       = null;
    let pomodorosComplete = 0; // count of completed work sessions in current 4-cycle (0-3)
    // Total completed pomodoros - persisted to localStorage
    let totalPomodorosCompleted = parseInt(localStorage.getItem(STORAGE_KEY) || "0", 10);

    const timerDisplay        = document.getElementById("timerDisplay");
    const sessionLabel        = document.getElementById("sessionLabel");
    const sessionTypeBadge    = document.getElementById("sessionTypeBadge");
    const startBtn            = document.getElementById("startBtn");
    const startBtnText        = document.getElementById("startBtnText");
    const resetBtn            = document.getElementById("resetBtn");
    const skipBtn             = document.getElementById("skipBtn");
    const pomodoroCountEl     = document.getElementById("pomodoroCount");
    const totalCountDisplay   = document.getElementById("totalCountDisplay");
    const resetCounterBtn     = document.getElementById("resetCounterBtn");
    const dots                = [
      document.getElementById("dot0"),
      document.getElementById("dot1"),
      document.getElementById("dot2"),
      document.getElementById("dot3"),
    ];

    // ---- Helpers ----
    function formatTime(secs) {
      const m = Math.floor(secs / 60).toString().padStart(2, "0");
      const s = (secs % 60).toString().padStart(2, "0");
      return `${m}:${s}`;
    }

    function updateDisplay() {
      timerDisplay.textContent = formatTime(remaining);
      setRingProgress(remaining / totalSeconds);
    }

    function setStartBtnState(isRunning) {
      startBtnText.textContent = isRunning ? "Pause" : "Start";
      startBtn.setAttribute("aria-label", isRunning ? "Pause timer" : "Start timer");
    }

    function updatePomodoroDots() {
      dots.forEach((dot, i) => {
        if (i < pomodorosComplete) {
          dot.classList.add("filled");
        } else {
          dot.classList.remove("filled");
        }
      });
      pomodoroCountEl.setAttribute(
        "aria-label",
        `Pomodoro progress: ${pomodorosComplete} of 4 completed`
      );
    }

    function updateTotalCounter(animate) {
      totalCountDisplay.textContent = totalPomodorosCompleted;
      totalCountDisplay.setAttribute(
        "aria-label",
        `Total completed pomodoros: ${totalPomodorosCompleted}`
      );
      localStorage.setItem(STORAGE_KEY, totalPomodorosCompleted);

      if (animate) {
        totalCountDisplay.classList.remove("counter-pop");
        void totalCountDisplay.offsetWidth; // force reflow
        totalCountDisplay.classList.add("counter-pop");
        totalCountDisplay.addEventListener("animationend", () => {
          totalCountDisplay.classList.remove("counter-pop");
        }, { once: true });
      }
    }

    function updateSessionBadge(sessionKey) {
      const session = SESSIONS[sessionKey];
      // Update badge text
      sessionTypeBadge.textContent = session.label.toUpperCase();

      // Update badge color class
      sessionTypeBadge.classList.remove("break", "long-break");
      ringProgress.classList.remove("break", "long-break");

      if (sessionKey === "shortBreak") {
        sessionTypeBadge.classList.add("break");
        ringProgress.classList.add("break");
      } else if (sessionKey === "longBreak") {
        sessionTypeBadge.classList.add("long-break");
        ringProgress.classList.add("long-break");
      }
    }

    function applySessionChange(autoStart) {
      currentSession = SESSION_CYCLE[cycleIndex];
      totalSeconds   = SESSIONS[currentSession].duration;
      remaining      = totalSeconds;

      sessionLabel.textContent = SESSIONS[currentSession].label;
      updateSessionBadge(currentSession);

      // Visual flash to indicate session change
      timerDisplay.classList.remove("session-change");
      sessionLabel.classList.remove("session-change");
      void timerDisplay.offsetWidth; // force reflow
      timerDisplay.classList.add("session-change");
      sessionLabel.classList.add("session-change");

      updateDisplay();

      // Auto-start the next session if triggered by timer completion
      if (autoStart) {
        intervalId = setInterval(tick, 1000);
        running    = true;
        setStartBtnState(true);
      }
    }

    // ---- Ripple effect ----
    function triggerRipple(btn, event) {
      const rect   = btn.getBoundingClientRect();
      const ripple = document.createElement("span");
      ripple.className = "ripple";

      const x = (event.clientX - rect.left) - 30;
      const y = (event.clientY - rect.top)  - 30;
      ripple.style.left = x + "px";
      ripple.style.top  = y + "px";

      btn.appendChild(ripple);
      ripple.addEventListener("animationend", () => ripple.remove());
    }

    // ---- Audio notification (Web Audio API) ----
    let audioCtx = null;

    function getAudioContext() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      return audioCtx;
    }

    function playCompletionSound() {
      try {
        const ctx = getAudioContext();

        // Gentle three-note chime: C5 -> E5 -> G5
        const notes = [523.25, 659.25, 783.99];
        const noteDuration = 0.18; // seconds per note
        const noteGap      = 0.06; // gap between notes

        notes.forEach(function(freq, i) {
          const startTime = ctx.currentTime + i * (noteDuration + noteGap);

          const oscillator = ctx.createOscillator();
          const gainNode   = ctx.createGain();

          oscillator.type      = "sine";
          oscillator.frequency.setValueAtTime(freq, startTime);

          // Gentle envelope: quick attack, smooth decay
          gainNode.gain.setValueAtTime(0, startTime);
          gainNode.gain.linearRampToValueAtTime(0.18, startTime + 0.03);
          gainNode.gain.exponentialRampToValueAtTime(0.001, startTime + noteDuration);

          oscillator.connect(gainNode);
          gainNode.connect(ctx.destination);

          oscillator.start(startTime);
          oscillator.stop(startTime + noteDuration);
        });
      } catch (err) {
        // Audio not supported or blocked â€” fail silently
        console.warn("Audio notification unavailable:", err);
      }
    }

    // ---- Timer logic ----
    function tick() {
      if (remaining <= 0) {
        clearInterval(intervalId);
        intervalId = null;
        running    = false;
        setStartBtnState(false);

        // Play completion sound
        playCompletionSound();

        // If completing a work session, increment pomodoro count
        if (currentSession === "work") {
          pomodorosComplete = (pomodorosComplete + 1) % 4;
          updatePomodoroDots();
          totalPomodorosCompleted++;
          updateTotalCounter(true);
        }

        // Auto-advance and auto-start the next session
        advanceSession(true);
        return;
      }
      remaining--;
      updateDisplay();
    }

    function toggleTimer() {
      if (running) {
        clearInterval(intervalId);
        intervalId = null;
        running    = false;
        setStartBtnState(false);
      } else {
        intervalId = setInterval(tick, 1000);
        running    = true;
        setStartBtnState(true);
      }
    }

    function resetTimer() {
      clearInterval(intervalId);
      intervalId = null;
      running    = false;
      remaining  = totalSeconds;
      setStartBtnState(false);
      updateDisplay();
    }

    function advanceSession(autoStart) {
      cycleIndex = (cycleIndex + 1) % SESSION_CYCLE.length;
      applySessionChange(autoStart || false);
    }

    function skipSession() {
      clearInterval(intervalId);
      intervalId = null;
      running    = false;
      setStartBtnState(false);
      advanceSession(false);
    }

    // ---- Event listeners ----
    startBtn.addEventListener("click", function(e) {
      triggerRipple(this, e);
      // Resume AudioContext if it was suspended (browser autoplay policy)
      const ctx = getAudioContext();
      if (ctx.state === "suspended") {
        ctx.resume();
      }
      toggleTimer();
    });

    resetBtn.addEventListener("click", function(e) {
      triggerRipple(this, e);
      resetTimer();
    });

    skipBtn.addEventListener("click", function(e) {
      triggerRipple(this, e);
      skipSession();
    });

    resetCounterBtn.addEventListener("click", function(e) {
      triggerRipple(this, e);
      totalPomodorosCompleted = 0;
      updateTotalCounter(false);
    });

    // ---- Init ----
    sessionLabel.textContent = SESSIONS[currentSession].label;
    updateSessionBadge(currentSession);
    updatePomodoroDots();
    updateDisplay();
    updateTotalCounter(false);
  </script>
</body>
</html>
